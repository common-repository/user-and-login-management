(()=>{let e,t,i,a,o=!1;function r(e){void 0===t&&(a=jQuery(i).closest("form").find("input[type=submit]")),"unlock"===e?(o=!1,a.removeAttr("disabled")):(o=!0,a.attr("disabled","disabled"))}function n(e,t){let i=t.get("control"),a=e.get("width"),o=e.get("height"),r=parseInt(i.params.width,10),n=parseInt(i.params.height,10),l=r/n;t.set("canSkipCrop",!0);let c=r,d=n;a/o>l?r=(n=o)*l:n=(r=a)/l;let s=(a-r)/2,u=(o-n)/2;return{handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:a,imageHeight:o,minWidth:c>r?r:c,minHeight:d>n?n:d,x1:s,y1:u,x2:r+s,y2:n+u,aspectRatio:`${r}:${n}`}}function l(e,t,i,a,o){let n={};n.url=e,n.thumbnail_url=e,n.timestamp=_.now(),t&&(n.attachment_id=t),i&&(n.width=i),a&&(n.height=a),r("lock"),jQuery.post(moUserMgLocalAvatars.ajaxurl,{action:"assign_user_mg_local_avatar_media",media_id:t,user_id:o,_wpnonce:moUserMgLocalAvatars.mediaNonce}).done(function(){location.reload()}).always(function(){r("unlock")})}jQuery(document).ready(function(t){t(".moul_mg_upload_profile_picture").on("click",function(t){let i=t.target.getAttribute("data-user-id");if(t.preventDefault(),o)return;let a={id:"control-id",params:{flex_width:!0,flex_height:!0,width:200,height:200}};(e=wp.media({button:{text:moUserMgLocalAvatars.selectCrop,close:!1},states:[new wp.media.controller.Library({title:moUserMgLocalAvatars.selectCrop,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:200,suggestedHeight:200}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:n,control:a}),]})).on("cropped",function(e){let{url:t}=e;l(t,e.id,e.width,e.height,i)}),e.on("skippedcrop",function(e){let t=e.get("url"),a=e.get("width"),o=e.get("height");l(t,e.id,a,o,i)}),e.on("select",function(){var t;let o=e.state().get("selection").first().toJSON();a.params.width!==o.width||a.params.height!==o.height||a.params.flex_width||a.params.flex_height?e.setState("cropper"):(o.dst_width=o.width,o.dst_height=o.height,t=o,r("lock"),jQuery.post(moUserMgLocalAvatars.ajaxurl,{action:"assign_user_mg_local_avatar_media",media_id:o,user_id:i,_wpnonce:moUserMgLocalAvatars.mediaNonce}).done(function(){location.reload()}).always(function(){r("unlock")}),e.close())}),e.open()}),t(".moul_mg_remove_profile_picture").on("click",function(e){if(window.confirm("Are yo sure you want to remove the profile picture.")){let i=e.target.getAttribute("data-user-id");e.preventDefault(),o||(r("lock"),t.get(moUserMgLocalAvatars.ajaxurl,{action:"remove_user_mg_local_avatar",user_id:i,_wpnonce:moUserMgLocalAvatars.removeAvatarNonce}).done(function(){location.reload()}).always(function(){r("unlock")}))}})})})(),jQuery("document").ready(function(){jQuery("#moul_mg_local_avatar").change(function(e){var t=URL.createObjectURL(e.target.files[0]);console.log(t),jQuery(".avatar").fadeIn("fast").attr("src",URL.createObjectURL(event.target.files[0]))})});